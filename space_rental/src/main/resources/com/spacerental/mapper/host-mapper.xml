<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spacerental.mapper.HostMapper">
	<sql id="hostBasicColumns">
		hostNo, hostId, name, content, type, address, parking, openstart, openend, holiday 
	</sql>
	
	<select id="selectHost" resultType="Host">
		select <include refid="hostBasicColumns" />, ok
		from host
		order by hostNo desc
	</select>
	
	<select id="selectHostByHostNo" parameterType="int" resultType="Host">
		select <include refid="hostBasicColumns" />, ok
		from host
		where hostNo = #{ hostNo }
	</select>
	
	<select id="selectHostFile" parameterType="int" resultType="SpaceFile">
		select sf.savedfilename
		from host h, space s, spacefile sf
		where h.hostno = s.hostno 
		and s.spaceno = sf.spaceno 
		and sf.flag = 1 
		and h.hostno = #{ hostNo }
		and rownum = 1
	</select>
	
	<!-- detail-files -->
	<select id="selectHostFilesByHostNo" parameterType="int" resultType="SpaceFile">
		select sf.savedfilename
		from host h, space s, spacefile sf
		where h.hostno = s.hostno 
		and s.spaceno = sf.spaceno  
		and h.hostno = #{ hostNo }
	</select>
	
	<!--  host등록   -->    	
	<insert id="insertHost" parameterType="Host" useGeneratedKeys="true" keyColumn="hostNo" keyProperty="hostNo">
		INSERT INTO HOST(
			<include refid="hostBasicColumns" />
		) VALUES(
			HOST_SEQUENCE.NEXTVAL
			, #{ hostId }
			, #{ name }
			, #{ content }
			, #{ type }
			, #{ address }
			, #{ parking }
			, #{ open }
			, #{ holiday }
		) 
	</insert>
	
	<select id="searchaddlist" parameterType="String" resultType="Host">
		select hostNo, hostId, name, content, type, address, parking, openstart, openend, holiday, ok
		from host
		WHERE ADDRESS LIKE '%'||#{ value }||'%'
		order by hostNo DESC 
	</select>
	
	<select id="searchspacelist" parameterType="String" resultType="Host">
		select hostNo, hostId, name, content, type, address, parking, openstart, openend, holiday, ok
		from host
		WHERE type LIKE '%'||#{ value }||'%'
		order by hostNo DESC 
	</select>
	
	<select id="searchPClist" resultType="Host">
		SELECT hostNo, hostId, name, content, type, address, parking, openstart, openend, holiday, ok
		FROM host
		WHERE hostNo IN (SELECT hostNo FROM SPACE WHERE computer='1')
		order by hostNo DESC 
	</select>
	<select id="searchBeamlist" resultType="Host">
		SELECT hostNo, hostId, name, content, type, address, parking, openstart, openend, holiday, ok
		FROM host
		WHERE hostNo IN (SELECT hostNo FROM SPACE WHERE bim ='1')
		order by hostNo DESC 
	</select>
	<select id="searchWifilist" resultType="Host">
		SELECT hostNo, hostId, name, content, type, address, parking, openstart, openend, holiday, ok
		FROM host
		WHERE hostNo IN (SELECT hostNo FROM SPACE WHERE wifi='1')
		order by hostNo DESC 
	</select>
	<select id="searchTenlesslist" resultType="Host">
		SELECT hostNo, hostId, name, content, type, address, parking, openstart, openend, holiday, ok
		FROM host
		where hostNo IN (<![CDATA[select hostNo from space where maximum < 10]]>)
		order by hostNo DESC
	</select> 
	<select id="searchTenmorelist" resultType="Host">
		SELECT hostNo, hostId, name, content, type, address, parking, openstart, openend, holiday, ok
		FROM host
		WHERE hostNo IN (<![CDATA[SELECT hostNo FROM SPACE WHERE maximum > 9]]>)
		order by hostNo DESC  
	</select>
</mapper>